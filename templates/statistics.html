{% extends "layout.html" %}
{% block title %}Menu iniziale{% endblock %}

{% block content %}

<h2
class="text-center mb-4"
style="font-family: 'Cinzel Decorative', serif;">
    Benvenuto in <span style="font-weight:bold">Saltatio Mortis<span>
</h2>

<div class="d-grid gap-2 col-6 mx-auto m-3">

    {% if current_user.is_authenticated %}
        <a href="{{ url_for('mission.select_mission') }}" class="btn btn-primary btn-lg">Seleziona Missione</a>
        {% if has_missioni %}
            <a href="{{ url_for('mission.show_mission') }}" class="btn btn-primary btn-lg">Mostra Missione</a>
        {% else %}
            <button class="btn btn-primary btn-lg" disabled>Mostra Missione (Missione non selezionata)</button>
        {% endif %}

        {% if can_select_char %}
            <a href="{{ url_for('battle.select_char') }}" class="btn btn-dark btn-lg">Inizia Battaglia</a>
        {% else %}
            <button class="btn btn-primary btn-lg btn-lg" disabled>Inizia Battaglia</button>
            <p class="text-muted text-center small">
                ‚ö†Ô∏è Crea almeno un personaggio e seleziona una missione per procedere
            </p>
        {% endif %}

    {% else %}
        <a href="{{ url_for('auth.login') }}" class="btn btn-info btn-lg">Login</a>
        <a href="{{ url_for('auth.sign_in') }}" class="btn btn-secondary btn-lg">Registrati</a>
    {% endif %}

<!-- Tabella classifica utenti -->
    <div class="mt-5">
        <h4 class="text-center mb-3">üèÜ Classifica Generale</h4>
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead class="table-dark">
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col">Nome Utente</th>
                        <th scope="col">Partite Giocate</th>
                        <th scope="col">Partite Vinte</th>
                        <th scope="col">Partite Perse</th>
                        <th scope="col">Punteggio</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user_id, user_data in users_stats_sorted %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td>
                            <i class="bi bi-person-circle"></i>
                            {{ user_data.nome }}
                        </td>
                        <td>
                            <span class="badge bg-secondary">{{ user_data.partite_giocate }}</span>
                        </td>
                        <td>
                            <span class="badge bg-success">{{ user_data.partite_vinte }}</span>
                        </td>
                        <td>
                            <span class="badge bg-danger">{{ user_data.partite_giocate - user_data.partite_vinte }}</span>
                        </td>
                        <td>
                            <span class="badge bg-primary">{{ user_data.punteggio }}</span>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% if not users_stats_sorted %}
            <div class="alert alert-info text-center">
                <i class="bi bi-info-circle"></i> Nessun utente registrato ancora!
            </div>
        {% endif %}
    </div>
</div>

{% endblock %}